import{d as Q,Q as W,b as y,S as fe,U as me,z as k,x as j,f as ve,o as z,c as Z,i as r,w as g,l as v,A as d,u as a,B as K,v as pe,k as C,h as V,F as U,O as ge,j as be,V as we,W as ke,r as _e,T as xe,X as Ie,Y as he}from"./index-b6327078.js";import{d as ye,u as T,E as N}from"./aria-c8f86cc5.js";import{f as Ne,s as ze,E as _,c as Ce,a as Ee,b as Oe,z as Te,d as Le,r as Re,e as Se}from"./index-d710a7f4.js";import{b as Ve,d as G,i as X,u as Ae,_ as Xe,w as Ye}from"./base-466dee4e.js";import{m as $e}from"./typescript-defaf979.js";import{i as Be,u as Me,a as Fe,k as De}from"./index-32a92878.js";var Pe="Expected a function";function A(b,E,f){var n=!0,p=!0;if(typeof b!="function")throw new TypeError(Pe);return Be(f)&&(n="leading"in f?!!f.leading:n,p="trailing"in f?!!f.trailing:p),ye(b,E,{leading:n,maxWait:E,trailing:p})}const He=Ve({urlList:{type:G(Array),default:()=>$e([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:G(String),default:"anonymous"}}),We={close:()=>!0,switch:b=>X(b),rotate:b=>X(b)},je=["src","crossorigin"],Ze=Q({name:"ElImageViewer"}),Ke=Q({...Ze,props:He,emits:We,setup(b,{expose:E,emit:f}){const n=b,p={CONTAIN:{name:"contain",icon:W(Ne)},ORIGINAL:{name:"original",icon:W(ze)}},{t:q}=Me(),o=Ae("image-viewer"),{nextZIndex:J}=Fe(),L=y(),Y=y([]),$=fe(),I=y(!0),ee=y(n.crossorigin),w=y(n.initialIndex),O=me(p.CONTAIN),l=y({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ae=k(()=>{const{urlList:e}=n;return e.length<=1}),B=k(()=>w.value===0),M=k(()=>w.value===n.urlList.length-1),te=k(()=>n.urlList[w.value]),ne=k(()=>[o.e("btn"),o.e("prev"),o.is("disabled",!n.infinite&&B.value)]),se=k(()=>[o.e("btn"),o.e("next"),o.is("disabled",!n.infinite&&M.value)]),oe=k(()=>{const{scale:e,deg:t,offsetX:s,offsetY:u,enableTransition:m}=l.value;let i=s/e,c=u/e;switch(t%360){case 90:case-270:[i,c]=[c,-i];break;case 180:case-180:[i,c]=[-i,-c];break;case 270:case-90:[i,c]=[-c,i];break}const h={transform:`scale(${e}) rotate(${t}deg) translate(${i}px, ${c}px)`,transition:m?"transform .3s":""};return O.value.name===p.CONTAIN.name&&(h.maxWidth=h.maxHeight="100%"),h}),le=k(()=>X(n.zIndex)?n.zIndex:J());function R(){ie(),f("close")}function re(){const e=A(s=>{switch(s.code){case N.esc:n.closeOnPressEscape&&R();break;case N.space:D();break;case N.left:P();break;case N.up:x("zoomIn");break;case N.right:H();break;case N.down:x("zoomOut");break}}),t=A(s=>{const u=s.deltaY||s.deltaX;x(u<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})});$.run(()=>{T(document,"keydown",e),T(document,"wheel",t)})}function ie(){$.stop()}function ue(){I.value=!1}function ce(e){I.value=!1,e.target.alt=q("el.image.error")}function de(e){if(I.value||e.button!==0||!L.value)return;l.value.enableTransition=!1;const{offsetX:t,offsetY:s}=l.value,u=e.pageX,m=e.pageY,i=A(h=>{l.value={...l.value,offsetX:t+h.pageX-u,offsetY:s+h.pageY-m}}),c=T(document,"mousemove",i);T(document,"mouseup",()=>{c()}),e.preventDefault()}function F(){l.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function D(){if(I.value)return;const e=De(p),t=Object.values(p),s=O.value.name,m=(t.findIndex(i=>i.name===s)+1)%e.length;O.value=p[e[m]],F()}function S(e){const t=n.urlList.length;w.value=(e+t)%t}function P(){B.value&&!n.infinite||S(w.value-1)}function H(){M.value&&!n.infinite||S(w.value+1)}function x(e,t={}){if(I.value)return;const{minScale:s,maxScale:u}=n,{zoomRate:m,rotateDeg:i,enableTransition:c}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...t};switch(e){case"zoomOut":l.value.scale>s&&(l.value.scale=Number.parseFloat((l.value.scale/m).toFixed(3)));break;case"zoomIn":l.value.scale<u&&(l.value.scale=Number.parseFloat((l.value.scale*m).toFixed(3)));break;case"clockwise":l.value.deg+=i,f("rotate",l.value.deg);break;case"anticlockwise":l.value.deg-=i,f("rotate",l.value.deg);break}l.value.enableTransition=c}return j(te,()=>{he(()=>{const e=Y.value[0];e!=null&&e.complete||(I.value=!0)})}),j(w,e=>{F(),f("switch",e)}),ve(()=>{var e,t;re(),(t=(e=L.value)==null?void 0:e.focus)==null||t.call(e)}),E({setActiveItem:S}),(e,t)=>(z(),Z(Ie,{to:"body",disabled:!e.teleported},[r(xe,{name:"viewer-fade",appear:""},{default:g(()=>[v("div",{ref_key:"wrapper",ref:L,tabindex:-1,class:d(a(o).e("wrapper")),style:K({zIndex:a(le)})},[v("div",{class:d(a(o).e("mask")),onClick:t[0]||(t[0]=pe(s=>e.hideOnClickModal&&R(),["self"]))},null,2),C(" CLOSE "),v("span",{class:d([a(o).e("btn"),a(o).e("close")]),onClick:R},[r(a(_),null,{default:g(()=>[r(a(Ce))]),_:1})],2),C(" ARROW "),a(ae)?C("v-if",!0):(z(),V(U,{key:0},[v("span",{class:d(a(ne)),onClick:P},[r(a(_),null,{default:g(()=>[r(a(Ee))]),_:1})],2),v("span",{class:d(a(se)),onClick:H},[r(a(_),null,{default:g(()=>[r(a(Oe))]),_:1})],2)],64)),C(" ACTIONS "),v("div",{class:d([a(o).e("btn"),a(o).e("actions")])},[v("div",{class:d(a(o).e("actions__inner"))},[r(a(_),{onClick:t[1]||(t[1]=s=>x("zoomOut"))},{default:g(()=>[r(a(Te))]),_:1}),r(a(_),{onClick:t[2]||(t[2]=s=>x("zoomIn"))},{default:g(()=>[r(a(Le))]),_:1}),v("i",{class:d(a(o).e("actions__divider"))},null,2),r(a(_),{onClick:D},{default:g(()=>[(z(),Z(ge(a(O).icon)))]),_:1}),v("i",{class:d(a(o).e("actions__divider"))},null,2),r(a(_),{onClick:t[3]||(t[3]=s=>x("anticlockwise"))},{default:g(()=>[r(a(Re))]),_:1}),r(a(_),{onClick:t[4]||(t[4]=s=>x("clockwise"))},{default:g(()=>[r(a(Se))]),_:1})],2)],2),C(" CANVAS "),v("div",{class:d(a(o).e("canvas"))},[(z(!0),V(U,null,be(e.urlList,(s,u)=>we((z(),V("img",{ref_for:!0,ref:m=>Y.value[u]=m,key:s,src:s,style:K(a(oe)),class:d(a(o).e("img")),crossorigin:ee.value,onLoad:ue,onError:ce,onMousedown:de},null,46,je)),[[ke,u===w.value]])),128))],2),_e(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var Ue=Xe(Ke,[["__file","image-viewer.vue"]]);const ta=Ye(Ue);export{ta as E};
